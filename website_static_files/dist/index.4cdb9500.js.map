{"mappings":"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","sources":["src/libraries/webrtc-signaling.js"],"sourcesContent":["/* See https://www.linux-projects.org/webrtc-signalling/ for a reference to signalling.js\n * window.mozRTCPeerConnection, window.mozRTCSessionDescription, window.mozRTCIceCandidate are now deprecated\n */\n\nRTCPeerConnection = window.RTCPeerConnection || /*window.mozRTCPeerConnection ||*/ window.webkitRTCPeerConnection;\nRTCSessionDescription = /*window.mozRTCSessionDescription ||*/ window.RTCSessionDescription;\nRTCIceCandidate = /*window.mozRTCIceCandidate ||*/ window.RTCIceCandidate;\n\nfunction signal(url, onStream, onError, onClose, onMessage, onDataChannelOpen) {\n    if (\"WebSocket\" in window) {\n        console.log(\"Opening signalling web socket: \" + url);\n        var wSocket = new WebSocket(url);\n        var peerConnection;\n        var iceCandidates = [];\n        var trickle_ice = true;\n        var hasRemoteDesc = false;\n\n        var mediaConstraints = {\n            optional: [],\n            mandatory: {\n                OfferToReceiveAudio: true,\n                OfferToReceiveVideo: true\n            }\n        };\n\n        function addIceCandidates() {\n            if (hasRemoteDesc) {\n                iceCandidates.forEach(function (candidate) {\n                    peerConnection.addIceCandidate(candidate,\n                        function () {\n                            console.log(\"IceCandidate added: \", candidate);\n                        },\n                        function (error) {\n                            console.error(\"addIceCandidate error: \" + error);\n                        }\n                    );\n                });\n                iceCandidates = [];\n            }\n        }\n\n        wSocket.onopen = function () {\n            /* First we create a peer connection */\n            var config = { \"iceServers\": [{ \"urls\": [\"stun:stun.l.google.com:19302\"] }] };\n            var options = {\n                optional: [\n                    // Deprecated:\n                    //{RtpDataChannels: false},\n                    //{DtlsSrtpKeyAgreement: true}\n                ]\n            };\n            peerConnection = new RTCPeerConnection(config, options);\n            iceCandidates = [];\n            hasRemoteDesc = false;\n\n            peerConnection.onicecandidate = function (event) {\n                if (event.candidate && event.candidate.candidate) {\n                    var candidate = {\n                        sdpMLineIndex: event.candidate.sdpMLineIndex,\n                        sdpMid: event.candidate.sdpMid,\n                        candidate: event.candidate.candidate\n                    };\n                    var request = {\n                        what: \"addIceCandidate\",\n                        data: JSON.stringify(candidate)\n                    };\n                    wSocket.send(JSON.stringify(request));\n                } else {\n                    console.log(\"end of candidates.\");\n                }\n            };\n\n            if ('ontrack' in peerConnection) {\n                peerConnection.ontrack = function (event) {\n                    console.log('pc.ontrack', event);       // <-- new line\n                    if (event.track.kind === 'video') {     // <-- new line\n                        onStream(event.streams[0]);\n                    }                                       // <-- new line\n                };\n            } else {  // onaddstream() deprecated\n                peerConnection.onaddstream = function (event) {\n                    onStream(event.stream);\n                };\n            }\n\n            peerConnection.onremovestream = function (event) {\n                console.log(\"the stream has been removed: do your stuff now\");\n            };\n\n            peerConnection.ondatachannel = function (event) {\n                console.log(\"a data channel is available: do your stuff with it\");\n                onDataChannelOpen(event)\n                // For an example, see https://www.linux-projects.org/uv4l/tutorials/webrtc-data-channels/\n            };\n\n            /* kindly signal the remote peer that we would like to initiate a call */\n            var request = {\n                what: \"call\",\n                options: {\n                    // If forced, the hardware codec depends on the arch.\n                    // (e.g. it's H264 on the Raspberry Pi)\n                    // Make sure the browser supports the codec too.\n                    force_hw_vcodec: false,\n                    vformat: 30, /* 30=640x480, 30 fps */\n                    trickle_ice: true\n                }\n            };\n            console.log(\"Sending signalling web socket message: \", request);\n            wSocket.send(JSON.stringify(request));\n        };\n\n        wSocket.onmessage = function (evt) {\n            var msg = JSON.parse(evt.data);\n            var what = msg.what;\n            var data = msg.data;\n\n            console.log(\"Received signalling web socket message: \", msg);\n\n            switch (what) {\n                case \"offer\":\n                    var mediaConstraints = {\n                        optional: [],\n                        mandatory: {\n                            OfferToReceiveAudio: false,\n                            OfferToReceiveVideo: true\n                        }\n\n                    };\n                    peerConnection.setRemoteDescription(new RTCSessionDescription(JSON.parse(data)),\n                        function onRemoteSdpSuccess() {\n                            hasRemoteDesc = true;\n                            addIceCandidates();\n                            peerConnection.createAnswer(function (sessionDescription) {\n                                peerConnection.setLocalDescription(sessionDescription);\n                                var request = {\n                                    what: \"answer\",\n                                    data: JSON.stringify(sessionDescription)\n                                };\n                                wSocket.send(JSON.stringify(request));\n                            }, function (error) {\n                                onError(\"failed to create answer: \" + error);\n                            }, mediaConstraints);\n                        },\n                        function onRemoteSdpError(event) {\n                            onError('failed to set the remote description: ' + event);\n                            wSocket.close();\n                        }\n                    );\n\n                    break;\n\n                case \"answer\":\n                    break;\n\n                case \"message\":\n                    if (onMessage) {\n                        onMessage(msg.data);\n                    }\n                    break;\n\n                case \"iceCandidate\": // received when trickle ice is used (see the \"call\" request)\n                    if (!msg.data) {\n                        console.log(\"Ice Gathering Complete\");\n                        break;\n                    }\n                    var elt = JSON.parse(msg.data);\n                    let candidate = new RTCIceCandidate({ sdpMLineIndex: elt.sdpMLineIndex, candidate: elt.candidate });\n                    iceCandidates.push(candidate);\n                    addIceCandidates(); // it internally checks if the remote description has been set\n                    break;\n\n                case \"iceCandidates\": // received when trickle ice is NOT used (see the \"call\" request)\n                    var candidates = JSON.parse(msg.data);\n                    for (var i = 0; candidates && i < candidates.length; i++) {\n                        var elt = candidates[i];\n                        let candidate = new RTCIceCandidate({ sdpMLineIndex: elt.sdpMLineIndex, candidate: elt.candidate });\n                        iceCandidates.push(candidate);\n                    }\n                    addIceCandidates();\n                    break;\n            }\n        };\n\n        wSocket.onclose = function (event) {\n            console.warn('Signalling web socket closed with code: ' + event.code);\n            if (peerConnection) {\n                peerConnection.close();\n                peerConnection = null;\n                wSocket = null;\n            }\n            if (onClose) {\n                onClose();\n            }\n        };\n\n        wSocket.onerror = function (event) {\n            onError(\"An error has occurred on the websocket (make sure the address is correct)!\");\n        };\n\n        this.hangup = function () {\n            if (wSocket) {\n                var request = {\n                    what: \"hangup\"\n                };\n                console.log(\"send message \" + JSON.stringify(request));\n                wSocket.send(JSON.stringify(request));\n            }\n        };\n\n    } else {\n        onError(\"Sorry, this browser does not support Web Sockets. Please use a newer browser.\");\n    }\n}"],"names":[],"version":3,"file":"index.4cdb9500.js.map","sourceRoot":"/__parcel_source_root/"}